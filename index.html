<link rel="stylesheet" type="text/css" href="styles/index.css">
<!DOCTYPE html>
<html>
<center>
  <header>
  </header>
  <div class="logo">
    <img src="https://img.icons8.com/clouds/200/000000/amazon.png" />
  </div>
  <div class="bar">
    <input class="searchbar" id="input" type="text" title="Search">
    <a href="#"> <img class="voice"
        src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e8/Google_mic.svg/716px-Google_mic.svg.png"
        title="Search by Voice"></a>
  </div>
  <div class="buttons">
    <button onclick="Search()" button class="button" type="button">Amazon Search</button>
  </div>
  </body>
  <script>
    src = "https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"
    function Search() 
    {
      var search = document.getElementById("input").value;
      console.log("Searching for " + search);
      const data = null;
      const reviewlist = [];
      var overallscore = 0;
      var postitve = 0;
      var negative = 0;
      var sentimentscore = "";
      const xhr = new XMLHttpRequest();
      xhr.withCredentials = true;

      xhr.addEventListener("readystatechange", function () {
        if (this.readyState === this.DONE) {
          let mysearch = JSON.parse(this.responseText);
          console.log(mysearch);
          for (let i = 0; i < mysearch.reviews.length; i++) {
            reviewlist.push(mysearch.reviews[i].review);
          }
          console.log(reviewlist);
          
          var rating = mysearch.average_rating;
          var rating = rating + " out of 5 Customer Reviews";
          console.log(rating);

          var productName = mysearch.product.name;
          console.log(productName);

          var productPicture = mysearch.product.image;
          console.log(productPicture);
          let dict = {};
          for (let i = 0; i < reviewlist.length; i++) 
          {
              const data2 = JSON.stringify({
              "language": "english",
              "text": reviewlist[i]
            });
            const xhr = new XMLHttpRequest();
            xhr.withCredentials = true;
            xhr.addEventListener("readystatechange", function () {
              if (this.readyState === this.DONE) {
                let sentimentanalysis = JSON.parse(this.responseText);
                postitve += sentimentanalysis.aggregate_sentiment.pos;
                negative += sentimentanalysis.aggregate_sentiment.neg;
                console.log(postitve, negative);
                if (!dict[i])
                {
                  dict[i] = []
                }
                dict[i].push([sentimentanalysis.aggregate_sentiment.pos, sentimentanalysis.aggregate_sentiment.neg]);
              }
              console.log(postitve, negative);
              //console.log(dict);
            });
            xhr.open("POST", "https://text-analysis12.p.rapidapi.com/sentiment-analysis/api/v1.1");
            xhr.setRequestHeader("content-type", "application/json");
            xhr.setRequestHeader("x-rapidapi-host", "text-analysis12.p.rapidapi.com");
            xhr.setRequestHeader("x-rapidapi-key", "9e6e243705mshffbc8d0d09663c3p101aa7jsn3da636feaa26");

            xhr.send(data2);
          }
          console.log(postitve,negative);
        }
      });

      xhr.open("GET", "https://easy-amazon-data-scraper.p.rapidapi.com/products/"+search+"/reviews?api_key=3ce35a11909b4ae05ec72636a71a02cf");
      xhr.setRequestHeader("x-rapidapi-host", "easy-amazon-data-scraper.p.rapidapi.com");
      xhr.setRequestHeader("x-rapidapi-key", "9e6e243705mshffbc8d0d09663c3p101aa7jsn3da636feaa26");

      xhr.send(data);
    }
  </script>